---
output: github_document
---


```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "figures/README-",
  out.width = "80%"
)
```

## Manual y ejemplos en español del paquete `speech` <img src='figures/logo.png' align="right" height="180" />

_Nicolas Schmidt, Diego Lujan, Juan Andres Moraes_


### Descripción

El paquete `speech` permite convertir diarios de sesión del parlamento uguguayo en formato PDF a bases de datos ordenadas en la que cada fila es la intervencion de cada uno de los legisladores que intervino en esa sesión.


##### Característias

* Este paquete construye todas las intervenciones por sesión de cada uno de los legisladores. Esto quiere decir que todas las intervenciones de los presidentes, secretarios, ministros o personas invitadas no identificadas como legisladores no van a ser recuperadas por el algoritmo. Muchas veces puede suceder que el algoritmo no identifique claramente alguna de estas intervenciones. En esos casos la función con la que se pasa de un `.pdf` a un `data.frame` tiene un argumento que permite incorporar esos casos que se desean eliminar.




### Ejemplo

Es importante tener presente que la lectura del texto de los archivos PDF de los diarios de sesion no es siempre clara. Muchos de los diarios de sesión que están en la página [web](https://parlamento.gub.uy/documentosyleyes/documentos/diarios-de-sesion) del parlamento están escaneados. 

En algunas ocasiones antes de convertir el documento PDF que contiene un diario de sesión mediante el uso de la función `speech_build()` va a ser necesario pasar el PDF por un OCR (reconocimiento óptico de caracteres por su sigla en ingles).

```{r example}
## vamos a trabajar con el primer diario de sesión de la Asamblea General desde la 
## reapertura democrática: 15 de febrero de 1985.

library(speech)
url <- "https://parlamento.gub.uy/documentosyleyes/documentos/diario-de-sesion/asambleageneral/1/IMG/0?width=800&height=600&hl=en_US1&iframe=true&rel=nofollow"
text <- speech::speech_build(file = url)
print(text, n = nrow(text))
```

Si bien la base de datos `text` luce bien se aprecian varios problemas que son producto de la lectura del documento. Este documento está escaneado y hay caracteres que no se leen corectamente: legislador 7 y 8 parecen ser el mismo pero al compilar los datos no se van a juntar ya que no son iguales; el legislador 25 y 26 es el mismo solo que en el primer caso hay un espacio en medio del apellido de uno de los legisladores. Tambien se aprecia que hay un legislador que no es llegislador y que no debería aparecer: 'PIRIESIDENTE' '(fila 19).


Comencemos por el ultimo problema. La función `speech_build()` tiene un argumento que permite eliminar legisladores: `rm.error.leg`

```{r }
text <- speech::speech_build(file = url, rm.error.leg = "PIRIESIDENTE")

## verificamos que ya no esté

print(text, n = nrow(text))
```

El paquete `speech` tiene una función que permite chequear los nombres de los legisaldores (`speech_check()`) y otra fundción que permite modificar fácilmente los nombres de los legisladores: `speech_legis_replace`.

Vamos a chequear los nombres:
```{r }
speech_check(text)
```

Ahora vamos a cambiar los nombres que están mal:
```{r }
text <- speech_legis_replace(text, old = "FElRREIRA Se",  new = "FERREIRA")
text <- speech_legis_replace(text, old = "V AILLANT",  new = "VAILLANT")
text <- speech_legis_replace(text, old = "PAZ AG",  new = "PAZ AGUIRRE")

## volvemos a verificar
speech_check(text)
```

```{r, echo = FALSE }
text <- as.data.frame(text)
```
Los problemas no se acaban acá. Exploremos los discursos propiamente dichos:

```{r }
text$speech[1]
text$speech[2]

```

```{r }
text <- speech::speech_build(file = url, 
                             rm.error.leg = "PIRIESIDENTE", 
                             add.error.sir = 'SEN\"OR')


text$speech[2]
```







